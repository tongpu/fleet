


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.12">
    
    
      
        <title>Expected Repo Structure - Fleet - GitOps at Scale</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4dd2dd8d.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.6a5ad368.min.css">
      
      
        
        
        <meta name="theme-color" content="#4cae4f">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Work+Sans:300,400,400i,700%7C&display=fallback">
        <style>body,input{font-family:"Work Sans",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#expected-repo-structure" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Fleet - GitOps at Scale" class="md-header-nav__button md-logo" aria-label="Fleet - GitOps at Scale">
      
  <img src="../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Fleet - GitOps at Scale
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Expected Repo Structure
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/rancher/fleet/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Fleet - GitOps at Scale" class="md-nav__button md-logo" aria-label="Fleet - GitOps at Scale">
      
  <img src="../assets/logo.svg" alt="logo">

    </a>
    Fleet - GitOps at Scale
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/rancher/fleet/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../quickstart/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../concepts/" title="Core Concepts" class="md-nav__link">
      Core Concepts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../examples/" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Operator Guide
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Operator Guide" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Operator Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1" type="checkbox" id="nav-6-1">
    
    <label class="md-nav__link" for="nav-6-1">
      Installation
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Installation" data-md-level="2">
      <label class="md-nav__title" for="nav-6-1">
        <span class="md-nav__icon md-icon"></span>
        Installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../installation/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../single-cluster-install/" title="Single Cluster Install" class="md-nav__link">
      Single Cluster Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../multi-cluster-install/" title="Multi-cluster Install" class="md-nav__link">
      Multi-cluster Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../uninstall/" title="Uninstall" class="md-nav__link">
      Uninstall
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      Managing Clusters
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Managing Clusters" data-md-level="2">
      <label class="md-nav__title" for="nav-6-2">
        <span class="md-nav__icon md-icon"></span>
        Managing Clusters
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-2-1" type="checkbox" id="nav-6-2-1">
    
    <label class="md-nav__link" for="nav-6-2-1">
      Registration
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Registration" data-md-level="3">
      <label class="md-nav__title" for="nav-6-2-1">
        <span class="md-nav__icon md-icon"></span>
        Registration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cluster-overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cluster-tokens/" title="Cluster Registration Tokens" class="md-nav__link">
      Cluster Registration Tokens
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../agent-initiated/" title="Agent Initiated" class="md-nav__link">
      Agent Initiated
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../manager-initiated/" title="Manager Initiated" class="md-nav__link">
      Manager Initiated
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cluster-group/" title="Cluster Groups" class="md-nav__link">
      Cluster Groups
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../namespaces/" title="Namespaces" class="md-nav__link">
      Namespaces
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      User Guide
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="User Guide" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-1" type="checkbox" id="nav-7-1" checked>
    
    <label class="md-nav__link" for="nav-7-1">
      Managing Git Repos
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Managing Git Repos" data-md-level="2">
      <label class="md-nav__title" for="nav-7-1">
        <span class="md-nav__icon md-icon"></span>
        Managing Git Repos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../gitrepo-add/" title="Registering" class="md-nav__link">
      Registering
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Expected Repo Structure
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="Expected Repo Structure" class="md-nav__link md-nav__link--active">
      Expected Repo Structure
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-repos-are-scanned" class="md-nav__link">
    How repos are scanned
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fleetyaml" class="md-nav__link">
    fleet.yaml
  </a>
  
    <nav class="md-nav" aria-label="fleet.yaml">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reference" class="md-nav__link">
    Reference
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per-cluster-customization" class="md-nav__link">
    Per Cluster Customization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#raw-yaml-resource-customization" class="md-nav__link">
    Raw YAML Resource Customization
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gitrepo-targets/" title="Mapping to Downstream Clusters" class="md-nav__link">
      Mapping to Downstream Clusters
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-repos-are-scanned" class="md-nav__link">
    How repos are scanned
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fleetyaml" class="md-nav__link">
    fleet.yaml
  </a>
  
    <nav class="md-nav" aria-label="fleet.yaml">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reference" class="md-nav__link">
    Reference
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per-cluster-customization" class="md-nav__link">
    Per Cluster Customization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#raw-yaml-resource-customization" class="md-nav__link">
    Raw YAML Resource Customization
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/rancher/fleet/edit/master/docs/gitrepo-structure.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="expected-repo-structure">Expected Repo Structure<a class="headerlink" href="#expected-repo-structure" title="Permanent link">&para;</a></h1>
<p><strong>The git repository has no explicitly required structure.</strong> It is important
to realize the scanned resources will be saved as a resource in Kubernetes so
you want to make sure the directories you are scanning in git do not contain
arbitrarily large resources. Right now there is a limitation that the resources
deployed must <strong>gzip to less than 1MB</strong>.</p>
<h2 id="how-repos-are-scanned">How repos are scanned<a class="headerlink" href="#how-repos-are-scanned" title="Permanent link">&para;</a></h2>
<p>Multiple paths can be defined for a <code>GitRepo</code> and each path is scanned independently.
Internally each scanned path will become a <a href="../concepts/">bundle</a> that Fleet will manage,
deploy, and monitor independently.</p>
<p>The following files are looked for to determine the how the resources will be deployed.</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Location</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Chart.yaml</strong>:</td>
<td>/ relative to <code>path</code> or custom path from <code>fleet.yaml</code></td>
<td>The resources will be deployed as a Helm chart. Refer to the <code>fleet.yaml</code> for more options.</td>
</tr>
<tr>
<td><strong>kustomization.yaml</strong>:</td>
<td>/ relative to <code>path</code> or custom path from <code>fleet.yaml</code></td>
<td>The resources will be deployed using Kustomize. Refer to the <code>fleet.yaml</code> for more options.</td>
</tr>
<tr>
<td><strong>fleet.yaml</strong></td>
<td>Any subpath</td>
<td>If any fleet.yaml is found a new <a href="../concepts/">bundle</a> will be defined. This allows mixing charts, kustomize, and raw YAML in the same repo</td>
</tr>
<tr>
<td><strong> *.yaml </strong></td>
<td>Any subpath</td>
<td>If a <code>Chart.yaml</code> or <code>kustomization.yaml</code> is not found then any <code>.yaml</code> file will be assumed to be a Kubernetes resource and will be deployed.</td>
</tr>
<tr>
<td><strong>overlays/{name}</strong></td>
<td>/ relative to <code>path</code></td>
<td>When deploying using raw YAML (not Kustomize or Helm) <code>overlays</code> is a special directory for customizations.</td>
</tr>
</tbody>
</table>
<h2 id="fleetyaml"><code>fleet.yaml</code><a class="headerlink" href="#fleetyaml" title="Permanent link">&para;</a></h2>
<p>The <code>fleet.yaml</code> is an optional file that can be included in the git repository to change the behavior of how
the resources are deployed and customized.  The <code>fleet.yaml</code> is always at the root relative to the <code>path</code> of the <code>GitRepo</code>
and if a subdirectory is found with a <code>fleet.yaml</code> a new <a href="../concepts/">bundle</a> is defined that will then be
configured differently from the parent bundle.</p>
<h3 id="reference">Reference<a class="headerlink" href="#reference" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># The default namespace to be applied to resources. This field is not used to</span>
<span class="c1"># enforce or lock down the deployment to a specific namespace, but instead</span>
<span class="c1"># provide the default value of the namespace field if one is not specified</span>
<span class="c1"># in the manifests. If you wish to actually restrict the namespace use then</span>
<span class="c1"># that should be done using the RBAC of the service account assigned to the</span>
<span class="c1"># GitRepo</span>
<span class="c1"># Default: default</span>
<span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>

<span class="nt">kustomize</span><span class="p">:</span>
  <span class="c1"># Use a custom folder for kustomize resources. This folder must contain</span>
  <span class="c1"># a kustomization.yaml file.</span>
  <span class="nt">dir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./kustomize</span>

<span class="nt">helm</span><span class="p">:</span>
  <span class="c1"># Use a custom location for the Helm chart. This can refer to any go-getter URL.</span>
  <span class="c1"># This allows one to download charts from most any location.  Also know that</span>
  <span class="c1"># go-getter URL supports adding a digest to validate the download. If repo</span>
  <span class="c1"># is set below this field is the name of the chart to lookup</span>
  <span class="nt">chart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./chart</span>
  <span class="c1"># A https URL to a Helm repo to download the chart from. It&#39;s typically easier</span>
  <span class="c1"># to just use `chart` field and refer to a tgz file.  If repo is used the</span>
  <span class="c1"># value of `chart` will be used as the chart name to lookup in the Helm repository.</span>
  <span class="nt">repo</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://charts.rancher.io</span>
  <span class="c1"># A custom release name to deploy the chart as. If not specified a release name</span>
  <span class="c1"># will be generated.</span>
  <span class="nt">releaseName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-release</span>
  <span class="c1"># The version of the chart or semver constraint of the chart to find. If a constraint</span>
  <span class="c1"># is specified it is evaluated each time git changes.</span>
  <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.1.0</span>
  <span class="c1"># Any values that should be placed in the `values.yaml` and passed to helm during</span>
  <span class="c1"># install.</span>
  <span class="nt">values</span><span class="p">:</span>
    <span class="nt">any-custom</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
  <span class="c1"># Override immutable resources. This could be dangerous.</span>
  <span class="nt">force</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="c1"># A paused bundle will not update downstream clusters but instead mark the bundle</span>
<span class="c1"># as OutOfSync. On can the manually confirm that a bundle should be deployed to</span>
<span class="c1"># the downstream clusters.</span>
<span class="c1"># Default: false</span>
<span class="nt">paused</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="nt">rolloutStrategy</span><span class="p">:</span>
    <span class="c1"># A number or percentage of clusters that can be unavailable during an update</span>
    <span class="c1"># of a bundle. This follows the same basic approach as a deployment rollout</span>
    <span class="c1"># strategy.</span>
    <span class="c1"># default: 10%</span>
    <span class="nt">maxUnavailable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">15%</span>
    <span class="c1"># A number or percentage of cluster partitions that can be unavailable during</span>
    <span class="c1"># an update of a bundle.</span>
    <span class="c1"># default: 0</span>
    <span class="nt">maxUnavailablePartitions</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">20%</span>
    <span class="c1"># A number of percentage of how to automatically partition clusters if not</span>
    <span class="c1"># specific partitioning strategy is configured.</span>
    <span class="c1"># default: 25%</span>
    <span class="nt">autoPartitionSize</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10%</span>
    <span class="c1"># A list of definitions of partitions.  If any target clusters do not match</span>
    <span class="c1"># the configuration they are added to partitions at the end following the</span>
    <span class="c1"># autoPartitionSize.</span>
    <span class="nt">partitions</span><span class="p">:</span>
      <span class="c1"># A user friend name given to the partition used for Display (optional).</span>
      <span class="c1"># default: &quot;&quot;</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">canary</span>
      <span class="c1"># A number or percentage of clusters that can be unavailable in this</span>
      <span class="c1"># partition before this partition is treated as done.</span>
      <span class="c1"># default: 10%</span>
      <span class="nt">maxUnavailable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10%</span>
      <span class="c1"># Selector matching cluster labels to include in this partition</span>
      <span class="nt">clusterSelector</span><span class="p">:</span>
        <span class="nt">matchLabels</span><span class="p">:</span>
          <span class="nt">env</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">prod</span>
      <span class="c1"># A cluster group name to include in this partition</span>
      <span class="nt">clusterGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">agroup</span>
      <span class="c1"># Selector matching cluster group labels to include in this partition</span>
      <span class="nt">clusterGroupSelector</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">agroup</span>

<span class="c1"># Target customization are used to determine how resources should be modified per target</span>
<span class="c1"># Targets are evaluated in order and the first one to match a cluster is used for that cluster.</span>
<span class="nt">targetCustomizations</span><span class="p">:</span>
<span class="c1"># The name of target. If not specified a default name of the format &quot;target000&quot;</span>
<span class="c1"># will be used. This value is mostly for display</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">prod</span>
  <span class="c1"># Custom namespace value overriding the value at the root</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">newvalue</span>
  <span class="c1"># Custom kustomize options overriding the options at the root</span>
  <span class="nt">kustomize</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
  <span class="c1"># Custom Helm options override the options at the root</span>
  <span class="nt">helm</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
  <span class="c1"># If using raw YAML these are names that map to overlays/{name} that will be used</span>
  <span class="c1"># to replace or patch a resource. If you wish to customize the file ./subdir/resource.yaml</span>
  <span class="c1"># then a file ./overlays/myoverlay/subdir/resource.yaml will replace the base file.</span>
  <span class="c1"># A file named ./overlays/myoverlay/subdir/resource_patch.yaml will patch the base file.</span>
  <span class="c1"># A patch can in JSON Patch or JSON Merge format or a strategic merge patch for builtin</span>
  <span class="c1"># Kubernetes types. Refer to &quot;Raw YAML Resource Customization&quot; below for more information.</span>
  <span class="nt">overlays</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">custom2</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">custom3</span>
  <span class="c1"># A selector used to match clusters.  The structure is the standard</span>
  <span class="c1"># metav1.LabelSelector format. If clusterGroupSelector or clusterGroup is specified,</span>
  <span class="c1"># clusterSelector will be used only to further refine the selection after</span>
  <span class="c1"># clusterGroupSelector and clusterGroup is evaluated.</span>
  <span class="nt">clusterSelector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">env</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">prod</span>
  <span class="c1"># A selector used to match cluster groups.</span>
  <span class="nt">clusterGroupSelector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">region</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">us-east</span>
  <span class="c1"># A specific clusterGroup by name that will be selected</span>
  <span class="nt">clusterGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">group1</span>
</code></pre></div>


<h2 id="per-cluster-customization">Per Cluster Customization<a class="headerlink" href="#per-cluster-customization" title="Permanent link">&para;</a></h2>
<p>The <code>GitRepo</code> defines which clusters a git repository should be deployed to and the <code>fleet.yaml</code> in the repository
determines how the resources are customized per target.</p>
<p>All clusters and cluster groups in the same namespace as the <code>GitRepo</code> will be evaluated against all targets of that
<code>GitRepo</code>. The targets list is evaluated one by one and if there is a match the resource will be deployed to the cluster.
If no match is made against the target list on the <code>GitRepo</code> then the resources will not be deployed to that cluster.
Once a target cluster is matched the <code>fleet.yaml</code> from the git repository is then consulted for customizations. The
<code>targetCustomizations</code> in the <code>fleet.yaml</code> will be evaluated one by one and the first match will define how the
resource is to be configured. If no match is made the resources will be deployed with no additional customizations.</p>
<p>There are three approaches to matching clusters for both <code>GitRepo</code> <code>targets</code> and <code>fleet.yaml</code> <code>targetCustomizations</code>.
One can use cluster selectors, cluster group selectors, or an explicit cluster group name.  All criteria is additive so
the final match is evaluated as "clusterSelector &amp;&amp; clusterGroupSelector &amp;&amp; clusterGroup".  If any of the three have the
default value it is dropped from the criteria.  The default value is either null or "".  It is important to realize
that the value <code>{}</code> for a selector means "match everything."</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Match everything</span>
<span class="nt">clusterSelector</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
<span class="c1"># Selector ignored</span>
<span class="nt">clusterSelector</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
</code></pre></div>


<h2 id="raw-yaml-resource-customization">Raw YAML Resource Customization<a class="headerlink" href="#raw-yaml-resource-customization" title="Permanent link">&para;</a></h2>
<p>When using Kustomize or Helm the <code>kustomization.yaml</code> or the <code>helm.values</code> will control how the resource are
customized per target cluster. If you are using raw YAML then the following simple mechanism is built-in and can
be used.  The <code>overlays/</code> folder in the git repo is treated specially as folder containing folders that
can be selected to overlay on top per target cluster. The resource overlay content
uses a file name based approach.  This is different from kustomize which uses a resource based approach.  In kustomize
the resource Group, Kind, Version, Name, and Namespace identify resources and are then merged or patched.  For Fleet
the overlay resources will override or patch content with a matching file name.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Base files</span>
deployment.yaml
svc.yaml

<span class="c1"># Overlay files</span>

<span class="c1"># The following file we be added</span>
overlays/custom/configmap.yaml
<span class="c1"># The following file will replace svc.yaml</span>
overlays/custom/svc.yaml
<span class="c1"># The following file will patch deployment.yaml</span>
overlays/custom/deployment_patch.yaml
</code></pre></div>


<p>A file named <code>foo</code> will replace a file called <code>foo</code> from the base resources or a previous overlay.  In order to patch
the contents a file the convention of adding <code>_patch.</code> (notice the trailing period) to the filename is used. The string <code>_patch.</code>
will be replaced with <code>.</code> from the file name and that will be used as the target.  For example <code>deployment_patch.yaml</code>
will target <code>deployment.yaml</code>.  The patch will be applied using JSON Merge, Strategic Merge Patch, or JSON Patch.
Which strategy is used is based on the file content. Even though JSON strategies are used, the files can be written
using YAML syntax.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../gitrepo-add/" title="Registering" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Registering
              </div>
            </div>
          </a>
        
        
          <a href="../gitrepo-targets/" title="Mapping to Downstream Clusters" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Mapping to Downstream Clusters
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.3636a4ec.min.js"></script>
      <script src="../assets/javascripts/bundle.e9fe3281.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>